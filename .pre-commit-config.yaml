repos:
  - repo: local
    hooks:
      # 1. RUFF LOCAL (via uv)
      - id: ruff
        name: ruff
        entry: uv run ruff check --fix --force-exclude
        language: system
        types: [python]
      - id: ruff-format
        name: ruff-format
        entry: uv run ruff format --force-exclude
        language: system
        types: [python]

      # 2. PRETTIER LOCAL (via npm dans src/front)
      # L'option --prefix permet d'utiliser le node_modules du sous-dossier
      - id: prettier
        name: prettier
        entry: npm exec --prefix src/front -- prettier --write --ignore-unknown
        language: system
        types_or: [javascript, jsx, ts, tsx, css, json, markdown, yaml]

      # 3. SECURITY (Local)
      - id: bandit
        name: bandit
        entry: uv run bandit -r src/
        language: system
        types: [python]
        files: ^src/
      - id: semgrep
        name: semgrep
        entry: uv run semgrep scan --config=auto --exclude='docker-compose.yml' --exclude='docker/**' --exclude='*.env.example' .
        language: system
        types_or: [python, javascript, ts, tsx]
        pass_filenames: false

      # 4. DEPENDENCY AUDITS (Local)
      - id: pip-audit
        name: pip-audit
        entry: uv run pip-audit
        language: system
        types: [python]
        pass_filenames: false
      - id: npm-audit
        name: npm-audit
        entry: npm audit --prefix src/front --audit-level=moderate
        language: system
        always_run: true
        pass_filenames: false

      # 5. FRONTEND SECURITY LINT
      - id: front-security-lint
        name: frontend-security-lint
        entry: npm run --prefix src/front lint:security
        language: system
        files: ^src/front/
        pass_filenames: false
