services:
  stimm:
    build:
      context: ../../
      dockerfile: ./docker/stimm/Dockerfile
    container_name: stimm
    volumes:
      # Mount source files to src subdirectory to preserve Python environment (read-write for development)
      - ../../src:/app/src
      # PulseAudio socket (host -> container)
      - /mnt/wslg:/mnt/wslg
    environment:
      - PULSE_SERVER=unix:/mnt/wslg/PulseServer
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - STIMM_API_URL=http://stimm:8001
      - LIVEKIT_URL=ws://livekit:7880
      - LIVEKIT_API_URL=http://livekit:7880
      - DATABASE_URL=postgresql://stimm_user:stimm_password@postgres:5432/stimm
      - QDRANT_URL=http://qdrant:6333
      - REDIS_URL=redis://redis:6379
      - FRONTEND_URL=http://stimm-front:3000
      - ENVIRONMENT=docker
    working_dir: /app
    ports:
      - "8001:8001"
    # Environment variables are loaded from env_file in root docker-compose.yml
    stdin_open: true
    tty: true
